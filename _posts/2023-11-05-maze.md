---
layout: post
title: "More Penpa+ Hacks"
date: 2023-11-05 10:00:00 -0400
tag: [Other, Coding]
---

I recommend checking out [my previous article about Penpa+ hacks]({% post_url 2023-10-30-snake %}) first.

I've made another couple of cursed discoveries of what one can do with Penpa+. Thw two things I want to talk about in this post are a collaborative r/Place copy in Penpa+ and [a Maze game](https://swaroopg92.github.io/penpa-edit/?m=solve&p=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&a=VcsxDsAwCEPRu3jOUEKA9iwo979GYm+V0BuMfjfMCgM2H+omp3S56NISSVNLxtUZqfHvEiyKj3qxR/9uHw==){:target="\_blank"}. I don't want to share the actual link for the Penpa+ Place to avoid griefing the canvas, but here's a couple pictures of its development.

<div id="gallery" style="max-width: 500px; height: 550px;">
<button onclick="plusDivs(-1)" style="width: 30px;height: 30px; font-size: 20px;line-height: 20px;">‚ùÆ</button>
<button onclick="plusDivs(1)" style="width: 30px;height: 30px; font-size: 20px;line-height: 20px;">‚ùØ</button>
<span id="num">1/5</span>
<img class="slides" src="{{ site.baseurl }}/assets/maze/penpaplace1.png">
<img class="slides" src="{{ site.baseurl }}/assets/maze/penpaplace2.png">
<img class="slides" src="{{ site.baseurl }}/assets/maze/penpaplace3.png">
<img class="slides" src="{{ site.baseurl }}/assets/maze/penpaplace4.png">
<img class="slides" src="{{ site.baseurl }}/assets/maze/penpaplace5.png">
</div>
<script>
var slideIndex = 1;showDivs(slideIndex);
function plusDivs(n) {showDivs(slideIndex += n);}
function showDivs(n) {
var i;
var x = document.getElementsByClassName("slides");
if (n > x.length) {slideIndex = 1}
if (n < 1) {slideIndex = x.length}
for (i = 0; i < x.length; i++) {x[i].style.display = "none";}
x[slideIndex-1].style.display = "block";
document.getElementById("num").innerHTML = slideIndex + "/5"
}
</script>

I wanted to make a post on how I made these two things.

# Penpa+ Place

After Snake, the next thing I wanted to experiment with was multiplayer compatibility. I figured out how to load code from other sources which allowed me use Firebase's Realtime Database, a free cloud-hosted database, which I've had experience using before. I read the surface elements the user inputs and add them to the database (there's no authentication here, which is why I don't want to make the original link public). I also have a listener which copies down any updates from the database back to the grid. I've also figured out how to attach code in Jekyll so you can see the [source code here]({{ site.baseurl }}/assets/maze/penpa-place.js) üôÇ

# Maze

Of course the natural thing to try to port into Penpa+ is Doom. This seemed very intimidating to me, so I wanted to get some practice working with 3d first (no promises on Doom ever happening though). I've always wanted to implement a raycaster, so I followed [3DSage's Raycasting Tutorial](https://www.youtube.com/watch?v=gYRrGTC7GtA){:target="\_blank"}. Most of the raycasting code is from this tutorial, with some modifications for Penpa+. Here's my [source code for the maze]({{ site.baseurl }}/assets/maze/raycast.js). I wanted to share some hacks/tips I discovered while creating this.

First, the win message. You don't need answer checking mode to be enabled, but I keep  it on so people aren't jumpscared by the message & are expecting an end. The code is:

```
let message = document.getElementById("custom_message").value;
if (message == "" || message.includes("http-equiv=")) {
    message = Identity.solveDefaultMessage;
}
setTimeout(() => {
    Swal.fire({
        title: Identity.solveTitle ? "<h3 class=wish style=color:white>" + Identity.solveTitle + "</h3>" : undefined,
        html: "<h2 class=`wish` style=color:white>" + message + "</h2>",
        background: "url(js/images/new_year.jpg)",
        icon: "success",
        confirmButtonText: Identity.solveOKButtonText,
    })
}, 20);
sw_timer.pause();
```
I should probably specify that this code just makes the congratulations message appear; I'm not checking against any pre-loaded solution.

Secondly, grid resizing. By default, the minimum 'display size' (i.e., the size of each box) of the grid is 12 units and if you try setting it lower, it will give an error message. Even if you programatically change it, it won't allow you to have a display size of less than 12! That is, unless you override the method that stops you.
```
Object.defineProperty(UserSettings, "displaysize", {
    set(newValue) {
        this._displaysize = newValue;
        redraw_grid();
    }
});
```
You can also dynamically resize your grid (the dimensions). I suspect this could lead to some puzzly ideas. See the maze source code for the full implementation.

Lastly, WASD/keyboard events. I added an handler for when keys were pressed/lifted:
```
window.onkeyup = function (e) {
    pressedKeys[e.keyCode] = false;
}
window.onkeydown = function (e) {
    pressedKeys[e.keyCode] = true;
}
```
then read from pressedKeys to tell of a key was pressed. A helpful website to get JS keycode info [can be found here](https://www.toptal.com/developers/keycode){:target="_blank"}. For mobile support, I read where shaded cells are in the grid when the user drags on the board and determined which diagonal quadrant of the board the shaded cell was.

It's still pretty easy to hack into the code and break it, but to disable the easiest way in, I removed the "resize grid" button: `document.getElementById("newsize").remove();`üòâ

# Ending thoughts
Penpa+ has been really fun to play around with :D

(I think) I pretty much understand how the surface mode grid works, but I still have no idea how the other modes (ex. edges, walls, etc.) work in terms of indices, nor non-square grids. I might play around with these modes more or try to make some creative puzzles taking advantage of this 'bug'.

I've seen a couple of Penpa+ hack creations that are actually puzzly, such as this [Statue Park (go fast)](https://tinyurl.com/yrh8bp45) by ft029 and [Choco Banana (Lights Out)](https://tinyurl.com/yn2dyh27) by lemononmars. I hope this inspires people to create some cool things!